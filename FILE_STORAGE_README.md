# 文件存储功能说明

## 功能概述

提醒事项应用现在支持将数据保存到本地文件，而不仅仅是浏览器的localStorage。这提供了更好的数据持久性和可移植性。

## 主要特性

### 1. 文件读取
- 点击侧边栏底部的"读取本地文件"按钮
- 支持选择JSON或TXT文件
- 使用现代浏览器的File System Access API

### 2. 保存为文件
- 点击"保存为文件"按钮将当前数据导出为本地文件
- 支持现代浏览器的文件保存API
- 传统浏览器自动回退到下载方式
- 文件名格式：`reminders_YYYY-MM-DD.json`

### 3. 智能存储策略
- **优先文件存储**：如果读取了文件，数据会优先保存到文件中
- **自动回退**：如果文件写入失败，自动回退到localStorage
- **缓存机制**：文件路径信息会缓存在localStorage中

### 4. 数据同步
- 每次编辑提醒事项时，数据会自动同步到读取的文件
- 支持实时保存，确保数据不丢失

### 5. 智能标签系统
- 自动从标题和备注中提取#开头的标签
- 标签格式：#标签名（以#开头，空格结尾）
- 支持在标题和备注中混合使用标签
- 自动去重和合并标签

### 6. 标签统计显示
- 在页面顶部header右侧显示标签统计
- 每个标签显示关联任务的数量
- 标签以蓝色圆角标签形式展示
- 支持悬停查看详细信息

### 7. 圆形进度条统计
- 使用圆形进度条显示每个标签的完成率
- 支持跨周统计，显示所有时间范围内的标签进度
- 显示格式："已完成/总数"（如：1/3）
- 进度条颜色根据完成率动态变化：
  - 绿色：100%完成
  - 蓝色：80-99%完成
  - 橙色：50-79%完成
  - 红色：0-49%完成
- 悬停显示详细信息：标签名、已完成/总数、完成率

### 8. 文件路径缓存
- 自动记录当前读取的文件路径到localStorage
- 下次打开应用时自动恢复文件连接
- 确保文件读取的连续性

## 使用方法

### 读取文件
1. 点击侧边栏底部的"读取本地文件"按钮
2. 在文件选择器中选择一个JSON或TXT文件
3. 确认选择后，应用会尝试从该文件读取现有数据
4. 文件路径会自动缓存到localStorage中

### 使用标签
1. 在提醒事项的标题或备注中使用#标签名格式
2. 标签会自动提取并保存到tags字段
3. 支持在标题和备注中混合使用多个标签
4. 标签会在页面顶部header右侧显示统计信息
5. 圆形进度条显示每个标签的完成率，支持跨周统计
6. 显示格式："已完成/总数"（如：1/3），直观了解任务进度

### 重新读取文件
1. 如果已经读取了文件，会显示"重新读取文件"按钮
2. 点击可以重新选择其他文件
3. 新文件会替换当前文件

### 保存为文件
1. 点击"保存为文件"按钮
2. 选择保存位置和文件名
3. 当前数据会导出为JSON文件
4. 如果支持，新文件会自动设为当前同步文件

### 清除文件选择
1. 点击"清除"按钮
2. 应用会回到localStorage模式
3. 所有数据会保存到浏览器的本地存储中

## 技术实现

### 浏览器兼容性
- **现代浏览器**：支持File System Access API，可以读写文件
- **传统浏览器**：回退到localStorage模式
- **兼容性检查**：自动检测浏览器支持的文件操作方法
- **多重回退**：支持 createWritable 和 createSyncAccessHandle 两种写入方式

### 文件格式
- 支持JSON格式（推荐）
- 支持TXT格式
- 数据以JSON字符串形式存储

### 错误处理
- 文件读取失败时自动回退到localStorage
- 文件写入失败时自动回退到localStorage
- 文件权限丢失时自动清除文件信息

## 注意事项

1. **文件权限**：首次选择文件时需要授予应用文件访问权限
2. **数据备份**：建议定期备份重要数据
3. **浏览器限制**：某些浏览器可能不支持文件系统访问
4. **文件大小**：大文件可能影响性能

## 故障排除

### 无法读取文件
- 检查浏览器是否支持File System Access API
- 确认已授予文件访问权限
- 尝试刷新页面后重新读取

### 数据未保存到文件
- 检查文件是否被其他程序占用
- 确认文件有写入权限
- 查看浏览器控制台的错误信息
- 如果出现"createWritable is not a function"错误，说明浏览器不支持该API，将自动回退到localStorage

### 文件访问丢失
- 可能是文件被移动或删除
- 浏览器可能清除了权限
- 重新读取文件即可恢复

## 未来计划

- 支持目录选择
- 支持多种文件格式
- 添加数据导入/导出功能
- 支持云端同步 